{"version":3,"file":null,"sources":["../src/background.js"],"sourcesContent":["/* global chrome */\n\nconst ports = {}\n\n//\n\nchrome.runtime.onConnect.addListener(onConnectToExtensionBackend)\n\n//\n\nfunction onConnectToExtensionBackend (port) {\n  const {tab, name} = resolvePortType(port)\n\n  if (!ports[tab]) {\n    ports[tab] = {\n      devtools: null,\n      contentScript: null\n    }\n  }\n\n  ports[tab][name] = port\n\n  if (ports[tab].devtools && ports[tab].contentScript) {\n    console.log('devtools <- backend ' + tab + ' -> content-script')\n    doublePipe(ports[tab])\n  }\n}\n\n//\n\nfunction resolvePortType (port) {\n  return false ||\n    isNumeric(port.name) && resolveAsDevtool(port) ||\n    resolveAsContentScript(port)\n}\n\nfunction doublePipe (metaPort) {\n  const {devtools, contentScript} = metaPort\n\n  devtools.onMessage.addListener(lDevtools)\n  function lDevtools (message) {\n    console.log('devtools -> backend -> contentScript', message)\n    contentScript.postMessage(message)\n  }\n  contentScript.onMessage.addListener(lContentScript)\n  function lContentScript (message) {\n    console.log('contentScript -> backend -> devtools', message)\n    devtools.postMessage(message)\n  }\n  function shutdown () {\n    console.log('contentScript x- backend -x devtools')\n    devtools.onMessage.removeListener(lDevtools)\n    contentScript.onMessage.removeListener(lContentScript)\n    devtools.disconnect()\n    contentScript.disconnect()\n\n    metaPort.devtools = metaPort.contentScript = null\n  }\n  devtools.onDisconnect.addListener(shutdown)\n  contentScript.onDisconnect.addListener(shutdown)\n}\n\n//\n\nfunction resolveAsDevtool (port) {\n  const tab = Number(port.name)\n  const name = 'devtools'\n\n  console.log(`new ${name} for tab n°${tab}`)\n  installContentScript(tab)\n  return { tab, name }\n}\n\nfunction resolveAsContentScript (port) {\n  const tab = Number(port.sender.tab.id)\n  const name = 'contentScript'\n\n  console.log(`new ${name} for tab n°${tab}`)\n  return { tab, name }\n}\n\nfunction isNumeric (str) {\n  return +str + '' === str\n}\n\nfunction installContentScript (tabId) {\n  chrome.tabs.executeScript(tabId, {\n    file: '/build/contentScript.js'\n  }, function () {})\n}\n\n"],"names":["ports","chrome","runtime","onConnect","addListener","onConnectToExtensionBackend","port","resolvePortType","tab","name","devtools","contentScript","log","isNumeric","resolveAsDevtool","resolveAsContentScript","doublePipe","metaPort","onMessage","lDevtools","message","postMessage","lContentScript","shutdown","removeListener","disconnect","onDisconnect","Number","sender","id","str","installContentScript","tabId","tabs","executeScript"],"mappings":";;;;;;AAAA;;AAEA,IAAMA,QAAQ,EAAd;;;;AAIAC,OAAOC,OAAP,CAAeC,SAAf,CAAyBC,WAAzB,CAAqCC,2BAArC;;;;AAIA,SAASA,2BAAT,CAAsCC,IAAtC,EAA4C;yBACtBC,gBAAgBD,IAAhB,CADsB;;MACnCE,GADmC,oBACnCA,GADmC;MAC9BC,IAD8B,oBAC9BA,IAD8B;;;MAGtC,CAACT,MAAMQ,GAAN,CAAL,EAAiB;UACTA,GAAN,IAAa;gBACD,IADC;qBAEI;KAFjB;;;QAMIA,GAAN,EAAWC,IAAX,IAAmBH,IAAnB;;MAEIN,MAAMQ,GAAN,EAAWE,QAAX,IAAuBV,MAAMQ,GAAN,EAAWG,aAAtC,EAAqD;YAC3CC,GAAR,CAAY,yBAAyBJ,GAAzB,GAA+B,oBAA3C;eACWR,MAAMQ,GAAN,CAAX;;;;;;AAMJ,SAASD,eAAT,CAA0BD,IAA1B,EAAgC;SACvB,SACLO,UAAUP,KAAKG,IAAf,KAAwBK,iBAAiBR,IAAjB,CADnB,IAELS,uBAAuBT,IAAvB,CAFF;;;AAKF,SAASU,UAAT,CAAqBC,QAArB,EAA+B;MACtBP,QADsB,GACKO,QADL,CACtBP,QADsB;MACZC,aADY,GACKM,QADL,CACZN,aADY;;;WAGpBO,SAAT,CAAmBd,WAAnB,CAA+Be,SAA/B;WACSA,SAAT,CAAoBC,OAApB,EAA6B;YACnBR,GAAR,CAAY,sCAAZ,EAAoDQ,OAApD;kBACcC,WAAd,CAA0BD,OAA1B;;gBAEYF,SAAd,CAAwBd,WAAxB,CAAoCkB,cAApC;WACSA,cAAT,CAAyBF,OAAzB,EAAkC;YACxBR,GAAR,CAAY,sCAAZ,EAAoDQ,OAApD;aACSC,WAAT,CAAqBD,OAArB;;WAEOG,QAAT,GAAqB;YACXX,GAAR,CAAY,sCAAZ;aACSM,SAAT,CAAmBM,cAAnB,CAAkCL,SAAlC;kBACcD,SAAd,CAAwBM,cAAxB,CAAuCF,cAAvC;aACSG,UAAT;kBACcA,UAAd;;aAESf,QAAT,GAAoBO,SAASN,aAAT,GAAyB,IAA7C;;WAEOe,YAAT,CAAsBtB,WAAtB,CAAkCmB,QAAlC;gBACcG,YAAd,CAA2BtB,WAA3B,CAAuCmB,QAAvC;;;;;AAKF,SAAST,gBAAT,CAA2BR,IAA3B,EAAiC;MACzBE,MAAMmB,OAAOrB,KAAKG,IAAZ,CAAZ;MACMA,OAAO,UAAb;;UAEQG,GAAR,UAAmBH,IAAnB,mBAAqCD,GAArC;uBACqBA,GAArB;SACO,EAAEA,QAAF,EAAOC,UAAP,EAAP;;;AAGF,SAASM,sBAAT,CAAiCT,IAAjC,EAAuC;MAC/BE,MAAMmB,OAAOrB,KAAKsB,MAAL,CAAYpB,GAAZ,CAAgBqB,EAAvB,CAAZ;MACMpB,OAAO,eAAb;;UAEQG,GAAR,UAAmBH,IAAnB,mBAAqCD,GAArC;SACO,EAAEA,QAAF,EAAOC,UAAP,EAAP;;;AAGF,SAASI,SAAT,CAAoBiB,GAApB,EAAyB;SAChB,CAACA,GAAD,GAAO,EAAP,KAAcA,GAArB;;;AAGF,SAASC,oBAAT,CAA+BC,KAA/B,EAAsC;SAC7BC,IAAP,CAAYC,aAAZ,CAA0BF,KAA1B,EAAiC;UACzB;GADR,EAEG,YAAY,EAFf;;;"}
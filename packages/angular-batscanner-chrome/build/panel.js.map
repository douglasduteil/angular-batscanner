{"version":3,"file":null,"sources":["../src/panel.js"],"sourcesContent":["/* global chrome */\n\nimport { Component, NgModule, NgZone } from '@angular/core'\nimport { Observable } from 'rxjs/Observable'\nimport { Subject } from 'rxjs/Subject'\n\nimport { DevToolModule } from 'angular-batscanner-devtool'\n\n//\n\nconst backendConnection$ = new Subject()\nconst backendMessage$ = backendConnection$\n  .startWith(1)\n  .switchMap(() => backendPortStream())\n\nexport function connectToTab () {\n  backendConnection$.next()\n}\n\n//\n\nconst BatscannerPanelComponent = Component({\n  selector: 'batscanner-panel',\n  template: `\n  <div>Hello batscanner-panel {{count}}</div>\n  <batscanner-debugger></batscanner-debugger>\n  `\n})\n.Class({\n  constructor: [NgZone, function BatscannerPanelComponent (ngZone) {\n    this._ngZone = ngZone\n    this.count = 0\n  }],\n\n  ngOnInit () {\n    //const backendPort$ = backendPortStream()\n    this.subscription = backendMessage$.subscribe(() => {\n      console.log('backend -> panel')\n      this._ngZone.run(() => {\n        this.count++\n      })\n    })\n\n    connectToTab()\n  },\n\n  ngOnDestroy () {\n    console.log('BatscannerPanelComponent#ngOnDestroy')\n    this.subscription.unsubscribe()\n  }\n})\n\nconst PanelModule = NgModule({\n  imports: [\n    window.ng.platformBrowser.BrowserModule,\n    DevToolModule\n  ],\n  declarations: [ BatscannerPanelComponent ],\n  bootstrap: [ BatscannerPanelComponent ]\n})\n.Class({constructor: function PanelModule () {}})\n\n//\n\ndocument.addEventListener('DOMContentLoaded', function () {\n  window.ng.platformBrowserDynamic\n    .platformBrowserDynamic()\n    .bootstrapModule(PanelModule)\n})\n\n//\n\nfunction backendPortStream () {\n  var port = chrome.runtime.connect({\n    name: '' + chrome.devtools.inspectedWindow.tabId\n  })\n\n  port.postMessage({message: 'brand new backend connection here :)'})\n\n  return Observable.create(function (observer) {\n    const broadcastNext = observer.next.bind(observer)\n    port.onMessage.addListener(broadcastNext)\n\n    port.onDisconnect.addListener(() => {\n      console.log('disconnect panel === complete ?')\n      observer.complete()\n    })\n\n    return function () {\n      port.onMessage.removeListener(broadcastNext)\n    }\n  })\n}\n"],"names":["backendConnection$","Subject","backendMessage$","startWith","switchMap","backendPortStream","connectToTab","next","BatscannerPanelComponent","Component","Class","NgZone","ngZone","_ngZone","count","subscription","subscribe","log","run","unsubscribe","PanelModule","NgModule","window","ng","platformBrowser","BrowserModule","DevToolModule","constructor","document","addEventListener","platformBrowserDynamic","bootstrapModule","port","chrome","runtime","connect","devtools","inspectedWindow","tabId","postMessage","message","Observable","create","observer","broadcastNext","bind","onMessage","addListener","onDisconnect","complete","removeListener"],"mappings":";;;;;;AAAA;;AAEA,AACA,AACA,AAEA,AAEA;;AAEA,IAAMA,qBAAqB,IAAIC,oBAAJ,EAA3B;AACA,IAAMC,kBAAkBF,mBACrBG,SADqB,CACX,CADW,EAErBC,SAFqB,CAEX;SAAMC,mBAAN;CAFW,CAAxB;;AAIA,AAAO,SAASC,YAAT,GAAyB;qBACXC,IAAnB;;;;;AAKF,IAAMC,2BAA2BC,wBAAU;YAC/B,kBAD+B;;CAAV,EAOhCC,KAPgC,CAO1B;eACQ,CAACC,oBAAD,EAAS,SAASH,wBAAT,CAAmCI,MAAnC,EAA2C;SAC1DC,OAAL,GAAeD,MAAf;SACKE,KAAL,GAAa,CAAb;GAFW,CADR;;UAAA,sBAMO;;;;SAELC,YAAL,GAAoBb,gBAAgBc,SAAhB,CAA0B,YAAM;cAC1CC,GAAR,CAAY,kBAAZ;YACKJ,OAAL,CAAaK,GAAb,CAAiB,YAAM;cAChBJ,KAAL;OADF;KAFkB,CAApB;;;GARG;aAAA,yBAkBU;YACLG,GAAR,CAAY,sCAAZ;SACKF,YAAL,CAAkBI,WAAlB;;CA3B6B,CAAjC;;AA+BA,IAAMC,cAAcC,uBAAS;WAClB,CACPC,OAAOC,EAAP,CAAUC,eAAV,CAA0BC,aADnB,EAEPC,sCAFO,CADkB;gBAKb,CAAElB,wBAAF,CALa;aAMhB,CAAEA,wBAAF;CANO,EAQnBE,KARmB,CAQb,EAACiB,aAAa,SAASP,WAAT,GAAwB,EAAtC,EARa,CAApB;;;;AAYAQ,SAASC,gBAAT,CAA0B,kBAA1B,EAA8C,YAAY;SACjDN,EAAP,CAAUO,sBAAV,CACGA,sBADH,GAEGC,eAFH,CAEmBX,WAFnB;CADF;;;;AAQA,SAASf,iBAAT,GAA8B;MACxB2B,OAAOC,OAAOC,OAAP,CAAeC,OAAf,CAAuB;UAC1B,KAAKF,OAAOG,QAAP,CAAgBC,eAAhB,CAAgCC;GADlC,CAAX;;OAIKC,WAAL,CAAiB,EAACC,SAAS,sCAAV,EAAjB;;SAEOC,2BAAWC,MAAX,CAAkB,UAAUC,QAAV,EAAoB;QACrCC,gBAAgBD,SAASpC,IAAT,CAAcsC,IAAd,CAAmBF,QAAnB,CAAtB;SACKG,SAAL,CAAeC,WAAf,CAA2BH,aAA3B;;SAEKI,YAAL,CAAkBD,WAAlB,CAA8B,YAAM;cAC1B9B,GAAR,CAAY,iCAAZ;eACSgC,QAAT;KAFF;;WAKO,YAAY;WACZH,SAAL,CAAeI,cAAf,CAA8BN,aAA9B;KADF;GATK,CAAP;;;;;;;"}